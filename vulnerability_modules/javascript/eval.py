from vulnerability_tool.framework.resources.types import ResourceType

TEST_NAME = "Javascript eval() Injection"
TEST_DESCRIPTION = """
This test checks if the built-in eval() function is used.
This function is dangerous because it allows malicious users to execute arbitrary code
on the application.
Sources:
https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval"""

def validate(file, languages_and_libraries):
    if ResourceType.JAVASCRIPT not in languages_and_libraries:
        return (None, None, None, None)

    status = "PASS"
    warning = None
    file_name, file_contents = file
    for line_number, line in enumerate(file_contents):
        if "eval(" in line:
            status = "FAIL"
            warning = "Injection Vulnerability in file: %s, line: %d." % (file_name, line_number)
            break

    return (TEST_NAME, TEST_DESCRIPTION, status, warning)
